<DOCTYPE html>
    <html>
      <!-- The html, css, js goes below here -->
      <head>
        <title>Color By Number</title>
      </head>
      <body>
        <h1>Color By Number</h1>

        <form id="uploadForm" >
          <input type="file" id="fileInput" name="fileInput" />
          <input type="submit" value="Upload" />
          <div id="imgPreview"></div>
        </form>
        <script>
          // show a preview of the image
          document.getElementById('fileInput').addEventListener('change', function(e) {
            var file = e.target.files[0];
            var reader = new FileReader();
            reader.onload = function(e) {
              var img = new Image();
              img.src = e.target.result;
              img.width = 200;
              document.getElementById('imgPreview').innerHTML = '';
              document.getElementById('imgPreview').appendChild(img);
            };
            reader.readAsDataURL(file);
          });

           // send some data to 127.0.0.1:5500 using a POST request
             document.getElementById('uploadForm').addEventListener('submit', function(e) {

                e.preventDefault();
                var fileInput = document.getElementById('fileInput');
    var file = fileInput.files[0];
    var reader = new FileReader();

    reader.onloadend = function() {
        // The result attribute contains the Data URL, which is a Base64 encoded string of the file
        var base64String = reader.result;

        // Create a JSON object
        var jsonObject = {
            image: base64String
        };

        // Convert the JSON object to a string
        var jsonString = JSON.stringify(jsonObject);
                // json encode 
                var form = e.target;
                var formData = new FormData(form);
                var xhr = new XMLHttpRequest();
                // content type set to json and send image to ['image']


                xhr.open('POST', '/image', true);
                xhr.setRequestHeader('Content-Type', 'application/json');

                xhr.onload = function() {
                    if (xhr.status === 200) {
                        console.log('success', xhr.responseText);
                        // returns base64 string replace with imgPreview and make it display the image
                        // decode the base64 string and display the image
                        var img = new Image();
                        img.src = 'data:image/png;base64,' + xhr.responseText;
                        img.width = 200;
                        document.getElementById('imgPreview').innerHTML = '';
                        document.getElementById('imgPreview').appendChild(img);
                        

                    }
                };
                xhr.send(jsonString);
              };
              reader.readAsDataURL(file);
            });
     
        </script>
        </body>
    </html>